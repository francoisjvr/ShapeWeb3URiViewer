<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Shape ERCâ€‘4804 Viewer</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0b0b0b;
      color: #eaeaea;
      margin: 0;
      padding: 16px;
    }
    header {
      margin-bottom: 16px;
    }
    input, button {
      padding: 8px;
      margin-right: 8px;
    }
    #status {
      opacity: 0.7;
      margin: 8px 0;
    }
    iframe {
      width: 100%;
      height: 80vh;
      border: 1px solid #333;
      background: white;
    }
    pre {
      background: #111;
      padding: 16px;
      overflow: auto;
    }
  </style>
</head>

<body>
<header>
  <h2>ðŸ§© Websiteâ€‘asâ€‘NFT Viewer (ERCâ€‘4804)</h2>
  <p>This NFT is a website served directly from Shape.</p>

  <input id="contract" placeholder="Contract address" />
  <input id="tokenId" placeholder="Token ID" />
  <button onclick="load()">View</button>

  <div id="status"></div>
</header>

<div id="output"></div>

<script type="module">
import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.8.1/+esm";

const provider = new ethers.JsonRpcProvider(
  "https://mainnet.shape.network"
);

async function load() {
  const contract = document.getElementById("contract").value;
  const tokenId = document.getElementById("tokenId").value;
  const status = document.getElementById("status");
  const output = document.getElementById("output");

  status.textContent = "Fetching onchain contentâ€¦";
  output.innerHTML = "";

  try {
    const abi = [
      "function tokenURI(uint256) view returns (string)",
      "function tokenURIMimeType(uint256) view returns (string)"
    ];

    const c = new ethers.Contract(contract, abi, provider);

    const mime = await c.tokenURIMimeType(tokenId);
    const data = await c.tokenURI(tokenId);

    status.textContent = `MIME type: ${mime}`;

    if (mime.includes("html")) {
      const iframe = document.createElement("iframe");
      iframe.srcdoc = data;
output.appendChild(iframe);
    } else if (mime.includes("json")) {
      const pre = document.createElement("pre");
      pre.textContent = JSON.stringify(JSON.parse(data), null, 2);
      output.appendChild(pre);
    } else {
      const pre = document.createElement("pre");
      pre.textContent = data;
      output.appendChild(pre);
    }

  } catch (err) {
    status.textContent = "Error loading content";
    output.textContent = err.message;
  }
}

window.load = load;
</script>
</body>
</html>
